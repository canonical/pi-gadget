name: pi
version: 20-1
summary: Raspberry Pi gadget
description: |
 Support files for booting Raspberry Pi.
 This gadget snap supports the Raspberry Pi Zero 2W, 2B, 3B, 3A+, 3B+, 4B, 400,
 Compute Module 3, 3+, and 4 universally.
type: gadget
base: core20
architectures:
  - build-on: [amd64, arm64]
    run-on: arm64
confinement: strict
grade: stable
parts:
  gadget:
    plugin: nil
    override-build: |
      if [ "$(arch)" != "aarch64" -a "$(arch)" != "armv7l" ]; then
        echo "Cross compilation detected; using pre-defined sources list"
        OPTIONAL_ARGS="SOURCES_HOST=\"./helpers/sources.list.cross\""
      fi
      make -C ${SNAPCRAFT_PROJECT_DIR:-.} default \
        DESTDIR=${SNAPCRAFT_PART_INSTALL} \
        ARCH=$(dpkg-architecture -t "${SNAPCRAFT_ARCH_TRIPLET}" -q DEB_HOST_ARCH) \
        ${OPTIONAL_ARGS:-}
    prime:
      - boot-assets/*
      - uboot.conf
      - boot.sel
    build-packages:
      - u-boot-tools
      - lsb-release


slots:
  bcm-gpio-0:
    interface: gpio
    number: 0
  bcm-gpio-1:
    interface: gpio
    number: 1
  bcm-gpio-2:
    interface: gpio
    number: 2
  bcm-gpio-3:
    interface: gpio
    number: 3
  bcm-gpio-4:
    interface: gpio
    number: 4
  bcm-gpio-5:
    interface: gpio
    number: 5
  bcm-gpio-6:
    interface: gpio
    number: 6
  bcm-gpio-7:
    interface: gpio
    number: 7
  bcm-gpio-8:
    interface: gpio
    number: 8
  bcm-gpio-9:
    interface: gpio
    number: 9
  bcm-gpio-10:
    interface: gpio
    number: 10
  bcm-gpio-11:
    interface: gpio
    number: 11
  bcm-gpio-12:
    interface: gpio
    number: 12
  bcm-gpio-13:
    interface: gpio
    number: 13
  bcm-gpio-14:
    interface: gpio
    number: 14
  bcm-gpio-15:
    interface: gpio
    number: 15
  bcm-gpio-16:
    interface: gpio
    number: 16
  bcm-gpio-17:
    interface: gpio
    number: 17
  bcm-gpio-18:
    interface: gpio
    number: 18
  bcm-gpio-19:
    interface: gpio
    number: 19
  bcm-gpio-20:
    interface: gpio
    number: 20
  bcm-gpio-21:
    interface: gpio
    number: 21
  bcm-gpio-22:
    interface: gpio
    number: 22
  bcm-gpio-23:
    interface: gpio
    number: 23
  bcm-gpio-24:
    interface: gpio
    number: 24
  bcm-gpio-25:
    interface: gpio
    number: 25
  bcm-gpio-26:
    interface: gpio
    number: 26
  bcm-gpio-27:
    interface: gpio
    number: 27
  i2c-0:
    interface: i2c
    path: /dev/i2c-0
  i2c-1:
    interface: i2c
    path: /dev/i2c-1
  i2c-2:
    interface: i2c
    path: /dev/i2c-2
  bt-serial:
    interface: serial-port
    path: /dev/ttyAMA0
  spidev0:
     interface: spi
     path: /dev/spidev0.0
  spidev1:
     interface: spi
     path: /dev/spidev0.1
